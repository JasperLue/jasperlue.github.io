<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description"/><title>Python技巧 | JasperLue的blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Python技巧</h1><a id="logo" href="/">JasperLue的blog</a><p class="description"></p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于我</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Python技巧</h1><div class="post-meta">2015-10-15 | <span class="categories">分类于<a href="/categories/tech/"> tech</a></span></div><span data-thread-key="2015/10/15/Python技巧/" class="ds-thread-count"></span><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#显示有限的接口到外部"><span class="toc-number">1.</span> <span class="toc-text">显示有限的接口到外部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#with的魔力"><span class="toc-number">2.</span> <span class="toc-text">with的魔力</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter的用法"><span class="toc-number">3.</span> <span class="toc-text">filter的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一行作判断"><span class="toc-number">4.</span> <span class="toc-text">一行作判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#装饰器之单例"><span class="toc-number">5.</span> <span class="toc-text">装饰器之单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#staticmethod装饰器"><span class="toc-number">6.</span> <span class="toc-text">staticmethod装饰器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#property装饰器"><span class="toc-number">7.</span> <span class="toc-text">property装饰器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iter魔法"><span class="toc-number">8.</span> <span class="toc-text">iter魔法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#神奇partial"><span class="toc-number">9.</span> <span class="toc-text">神奇partial</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#神秘eval"><span class="toc-number">10.</span> <span class="toc-text">神秘eval</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getattr"><span class="toc-number">11.</span> <span class="toc-text">getattr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读写csv文件"><span class="toc-number">12.</span> <span class="toc-text">读写csv文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#各种时间形式转换"><span class="toc-number">13.</span> <span class="toc-text">各种时间形式转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串格式化"><span class="toc-number">14.</span> <span class="toc-text">字符串格式化</span></a></li></ol></div></div><div class="post-content"><h3 id="显示有限的接口到外部">显示有限的接口到外部</h3><p>当发布python第三方package时，并不希望代码中所有的函数或者class可以被外部import，在<strong>init</strong>.py中添加<strong>all</strong>属性，该list中填写可以import的类或者函数名，可以起到限制的import的作用，防止外部import其他函数或者类。<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> base <span class="keyword">import</span> APIBase</span><br><span class="line"><span class="keyword">from</span> client <span class="keyword">import</span> Client</span><br><span class="line"><span class="keyword">from</span> decorator <span class="keyword">import</span> interface, <span class="keyword">export</span>, stream</span><br><span class="line"><span class="keyword">from</span> server <span class="keyword">import</span> Server</span><br><span class="line"><span class="keyword">from</span> storage <span class="keyword">import</span> Storage</span><br><span class="line"><span class="keyword">from</span> util <span class="keyword">import</span> (LogFormatter, disable_logging_to_stderr,</span><br><span class="line">                       enable_logging_to_kids, info)</span><br><span class="line">__all__ = [<span class="string">'APIBase'</span>, <span class="string">'Client'</span>, <span class="string">'LogFormatter'</span>, <span class="string">'Server'</span>,</span><br><span class="line">           <span class="string">'Storage'</span>, <span class="string">'disable_logging_to_stderr'</span>, <span class="string">'enable_logging_to_kids'</span>,</span><br><span class="line">           <span class="string">'export'</span>, <span class="string">'info'</span>, <span class="string">'interface'</span>, <span class="string">'stream'</span>]</span><br></pre></td></tr></table></figure></p>
<h3 id="with的魔力">with的魔力</h3><p>with语句需要支持上下文管理协议的对象, 上下文管理协议包含<strong>enter</strong>和<strong>exit</strong>两个方法。with语句建立运行时上下文需要通过这两个方法执行进入和退出操作。<br>其中上下文表达式是跟在with之后的表达式, 该表示大返回一个上下文管理对象。<br>常见with使用场景<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">with</span> <span class="built_in">open</span>(<span class="string">"test.txt"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> my_file:  <span class="comment"># 注意, 是__enter__()方法的返回值赋值给了my_file,</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">line</span> <span class="operator">in</span> my_file:</span><br><span class="line">        print <span class="built_in">line</span></span><br></pre></td></tr></table></figure></p>
<p>详细原理可以查看这篇文章： 浅谈 Python 的 with 语句<br>知道具体原理, 我们可以自定义支持上下文管理协议的类, 类中实现<strong>enter</strong>和<strong>exit</strong>方法。<br>执行结果如下：<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__init__ <span class="keyword">method</span></span><br><span class="line">__enter__ <span class="keyword">method</span></span><br><span class="line">running my_with</span><br><span class="line">__exit__ <span class="keyword">method</span></span><br><span class="line"><span class="type">Exited</span> <span class="keyword">without</span> <span class="type">Exception</span></span><br><span class="line">------分割线-----</span><br><span class="line">__init__ <span class="keyword">method</span></span><br><span class="line">__enter__ <span class="keyword">method</span></span><br><span class="line">running before <span class="type">Exception</span></span><br><span class="line">__exit__ <span class="keyword">method</span></span><br><span class="line"><span class="type">Exited</span> <span class="keyword">with</span> <span class="type">Exception</span></span><br><span class="line"><span class="type">Traceback</span> (most recent call last):</span><br><span class="line">  <span class="type">File</span> <span class="string">"bin/python"</span>, line <span class="number">34</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    exec(compile(__file__f.read(), __file__, <span class="string">"exec"</span>))</span><br><span class="line">  <span class="type">File</span> <span class="string">"test_with.py"</span>, line <span class="number">33</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    test_with()</span><br><span class="line">  <span class="type">File</span> <span class="string">"test_with.py"</span>, line <span class="number">28</span>, <span class="keyword">in</span> test_with</span><br><span class="line">    <span class="keyword">raise</span> <span class="type">Exception</span></span><br><span class="line"><span class="type">Exception</span></span><br></pre></td></tr></table></figure></p>
<p>证明了会先执行<strong>enter</strong>方法，然后调用with内的逻辑，最后执行<strong>exit</strong>做退出处理，并且即使出现异常也能正常退出。</p>
<h3 id="filter的用法">filter的用法</h3><p>相对filter而言, map和reduce使用的会更频繁一些, filter正如其名字, 按照某种规则过滤掉一些元素<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#!/usr/bin/env python</span></span><br><span class="line"><span class="preprocessor"># -*- coding: utf-<span class="number">8</span> -*-</span></span><br><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="preprocessor"># 所有奇数都会返回True, 偶数会返回False被过滤掉</span></span><br><span class="line"><span class="function">print <span class="title">filter</span><span class="params">(lambda x: x % <span class="number">2</span> != <span class="number">0</span>, lst)</span></span><br><span class="line"># 输出结果</span><br><span class="line">[1, 3, 5]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="一行作判断">一行作判断</h3><p>当条件满足时, 返回的为等号后面的变量, 否则返回else后语句<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">new_lst = lst[<span class="number">0</span>] <span class="keyword">if</span> lst <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="keyword">None</span></span><br><span class="line"><span class="keyword">print</span> new_lst</span><br><span class="line"><span class="comment"># 打印结果</span></span><br></pre></td></tr></table></figure></p>
<h3 id="装饰器之单例">装饰器之单例</h3><p>使用装饰器实现简单的单例模式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单例装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(cls)</span>:</span></span><br><span class="line">    instances = dict()  <span class="comment"># 初始为空</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_singleton</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances:  <span class="comment">#如果不存在, 则创建并放入字典</span></span><br><span class="line">            instances[cls] = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> instances[cls]</span><br><span class="line">    <span class="keyword">return</span> _singleton</span><br><span class="line"><span class="decorator">@singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t1 = Test()</span><br><span class="line">    t2 = Test()</span><br><span class="line">    <span class="comment"># 两者具有相同的地址</span></span><br><span class="line">    <span class="keyword">print</span> t1, t2</span><br></pre></td></tr></table></figure></p>
<h3 id="staticmethod装饰器">staticmethod装饰器</h3><p>类中两种常用的装饰, 首先区分一下他们：</p>
<ul>
<li>普通成员函数, 其中第一个隐式参数为对象；</li>
<li>classmethod装饰器, 类方法(给人感觉非常类似于OC中的类方法), 其中第一个隐式参数为类；</li>
<li>staticmethod装饰器, 没有任何隐式参数. python中的静态方法类似与C++中的静态方法；</li>
</ul>
<h3 id="property装饰器">property装饰器</h3><p>定义私有类属性<br>将property与装饰器结合实现属性私有化(更简单安全的实现get和set方法)<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">#python</span>内建函数</span><br><span class="line">property(fget=<span class="literal">None</span>, fset=<span class="literal">None</span>, fdel=<span class="literal">None</span>, doc=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></p>
<p>fget是获取属性的值的函数，fset是设置属性值的函数，fdel是删除属性的函数，doc是一个字符串(like a comment)。从实现来看，这些参数都是可选的。<br>property有三个方法getter(), setter()和delete() 来指定fget, fset和fdel。 这表示以下这行<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="decorator">    @property  #相当于property.getter(score) 或者property(score)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">score</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._score</span><br><span class="line"><span class="decorator">    @score.setter #相当于score = property.setter(score)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">score</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, int):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must be an integer!'</span>)</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">0</span> <span class="keyword">or</span> value &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must between 0 ~ 100!'</span>)</span><br><span class="line">        self._score = value</span><br></pre></td></tr></table></figure></p>
<h3 id="iter魔法">iter魔法</h3><p>通过yield和<strong>iter</strong>的结合, 我们可以把一个对象变成可迭代的；<br>通过<strong>str</strong>的重写, 可以直接通过想要的形式打印对象；<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestIter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> ele <span class="keyword">in</span> xrange(len(self.lst)):</span><br><span class="line">            <span class="keyword">yield</span> ele</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.read()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">','</span>.join(map(str, self.lst))</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_iter</span><span class="params">()</span>:</span></span><br><span class="line">    obj = TestIter()</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> obj:</span><br><span class="line">        <span class="keyword">print</span> num</span><br><span class="line">    <span class="keyword">print</span> obj</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_iter()</span><br></pre></td></tr></table></figure></p>
<h3 id="神奇partial">神奇partial</h3><p>partial使用上很像C++中仿函数(函数对象).<br>在stackoverflow给出了类似与partial的运行方式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial</span><span class="params">(func, *part_args)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*extra_args)</span>:</span></span><br><span class="line">        args = list(part_args)</span><br><span class="line">        args.extend(extra_args)</span><br><span class="line">        <span class="keyword">return</span> func(*args)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure></p>
<p>利用用闭包的特性绑定预先绑定一些函数参数, 返回一个可调用的变量, 直到真正的调用执行。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_partial</span><span class="params">()</span>:</span></span><br><span class="line">    fun = partial(sum, <span class="number">2</span>)   <span class="comment"># 事先绑定一个参数, fun成为一个只需要一个参数的可调用变量</span></span><br><span class="line">    <span class="keyword">print</span> fun(<span class="number">3</span>)  <span class="comment"># 实现执行的即是sum(2, 3)</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_partial()</span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<h3 id="神秘eval">神秘eval</h3><p>eval我理解为一种内嵌的python解释器(这种解释可能会有偏差), 会解释字符串为对应的代码并执行, 并且将执行结果返回。<br>看一下下面这个例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">def <span class="built_in">test</span>_first():</span><br><span class="line">    <span class="built_in">return</span> <span class="number">3</span></span><br><span class="line">def <span class="built_in">test</span>_second(num):</span><br><span class="line">    <span class="built_in">return</span> num</span><br><span class="line">action = &#123;  <span class="comment"># 可以看做是一个sandbox</span></span><br><span class="line">        <span class="string">"para"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">"test_first"</span> : <span class="built_in">test</span>_first,</span><br><span class="line">        <span class="string">"test_second"</span>: <span class="built_in">test</span>_second</span><br><span class="line">        &#125;</span><br><span class="line">def <span class="built_in">test</span>_eavl():  </span><br><span class="line">    condition = <span class="string">"para == 5 and test_second(test_first) &gt; 5"</span></span><br><span class="line">    res = <span class="built_in">eval</span>(condition, action)  <span class="comment"># 解释condition并根据action对应的动作执行</span></span><br><span class="line">    <span class="built_in">print</span> res</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'_</span><br><span class="line">### exec</span></span><br></pre></td></tr></table></figure></p>
<p>exec在Python中会忽略返回值, 总是返回None, eval会返回执行代码或语句的返回值<br>exec和eval在执行代码时, 除了返回值其他行为都相同<br>在传入字符串时, 会使用compile(source,’<string>‘, mode)编译字节码. mode的取值为exec和eval<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_first</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"hello"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_second</span><span class="params">()</span>:</span></span><br><span class="line">    test_first()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"second"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_third</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"third"</span></span><br><span class="line">action = &#123;</span><br><span class="line">        <span class="string">"test_second"</span>: test_second,</span><br><span class="line">        <span class="string">"test_third"</span>: test_third</span><br><span class="line">        &#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_exec</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">exec</span> <span class="string">"test_second"</span> <span class="keyword">in</span> action</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_exec()  <span class="comment"># 无法看到执行结果</span></span><br></pre></td></tr></table></figure></string></p>
<h3 id="getattr">getattr</h3><p>getattr(object, name[, default])Return the value of the named attribute of object. name must be a string. If the string is the name of one of the object’s attributes, the result is the value of that attribute. For example, getattr(x, ‘foobar’) is equivalent to x.foobar. If the named attribute does not exist, default is returned if provided, otherwise AttributeError is raised.<br>通过string类型的name, 返回对象的name属性(方法)对应的值, 如果属性不存在, 则返回默认值, 相当于object.name<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用范例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestGetAttr</span><span class="params">(object)</span>:</span></span><br><span class="line">    test = <span class="string">"test attribute"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"test method"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_getattr</span><span class="params">()</span>:</span></span><br><span class="line">    my_test = TestGetAttr()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">print</span> getattr(my_test, <span class="string">"test"</span>)</span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Attribute Error!"</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        getattr(my_test, <span class="string">"say"</span>)()</span><br><span class="line">    <span class="keyword">except</span> AttributeError: <span class="comment"># 没有该属性, 且没有指定返回值的情况下</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Method Error!"</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_getattr()</span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">test attribute</span><br><span class="line">test method</span><br></pre></td></tr></table></figure></p>
<p>命令行处理<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_command_line</span><span class="params">(argv)</span>:</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">    Return a 2-tuple: (settings object, args list).</span><br><span class="line">    `argv` is a list of arguments, or `None` for ``sys.argv[1:]``.</span><br><span class="line">    """</span></span><br><span class="line">    <span class="keyword">if</span> argv <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        argv = sys.argv[<span class="number">1</span>:]</span><br><span class="line">    <span class="comment"># initialize the parser object:</span></span><br><span class="line">    parser = optparse.OptionParser(</span><br><span class="line">        formatter=optparse.TitledHelpFormatter(width=<span class="number">78</span>),</span><br><span class="line">        add_help_option=<span class="keyword">None</span>)</span><br><span class="line">    <span class="comment"># define options here:</span></span><br><span class="line">    parser.add_option(      <span class="comment"># customized description; put --help last</span></span><br><span class="line">        <span class="string">'-h'</span>, <span class="string">'--help'</span>, action=<span class="string">'help'</span>,</span><br><span class="line">        help=<span class="string">'Show this help message and exit.'</span>)</span><br><span class="line">    settings, args = parser.parse_args(argv)</span><br><span class="line">    <span class="comment"># check number of arguments, verify values, etc.:</span></span><br><span class="line">    <span class="keyword">if</span> args:</span><br><span class="line">        parser.error(<span class="string">'program takes no command-line arguments; '</span></span><br><span class="line">                     <span class="string">'"%s" ignored.'</span> % (args,))</span><br><span class="line">    <span class="comment"># further process settings &amp; args if necessary</span></span><br><span class="line">    <span class="keyword">return</span> settings, args</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv=None)</span>:</span></span><br><span class="line">    settings, args = process_command_line(argv)</span><br><span class="line">    <span class="comment"># application code here, like:</span></span><br><span class="line">    <span class="comment"># run(settings, args)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>        <span class="comment"># success</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    status = main()</span><br><span class="line">    sys.exit(status)</span><br></pre></td></tr></table></figure></p>
<h3 id="读写csv文件">读写csv文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从csv中读取文件, 基本和传统文件读取类似</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        <span class="keyword">print</span> row</span><br><span class="line"><span class="comment"># 向csv文件写入</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open( <span class="string">'data.csv'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    writer = csv.writer(f)</span><br><span class="line">    writer.writerow([<span class="string">'name'</span>, <span class="string">'address'</span>, <span class="string">'age'</span>])  <span class="comment"># 单行写入</span></span><br><span class="line">    data = [</span><br><span class="line">            ( <span class="string">'xiaoming '</span>,<span class="string">'china'</span>,<span class="string">'10'</span>),</span><br><span class="line">            ( <span class="string">'Lily'</span>, <span class="string">'USA'</span>, <span class="string">'12'</span>)]</span><br><span class="line">    writer.writerows(data)  <span class="comment"># 多行写入</span></span><br></pre></td></tr></table></figure>
<h3 id="各种时间形式转换">各种时间形式转换</h3><p>只发一张网上的图, 然后差文档就好了, 这个是记不住的<br><img src="https://app.yinxiang.com/shard/s52/res/2efdd430-547e-4bc9-95fc-2bfb068d7c03.jpg" alt="图片描述"></p>
<h3 id="字符串格式化">字符串格式化</h3><p>一个非常好用, 很多人又不知道的功能。<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="property">name</span> = <span class="string">"andrew"</span></span><br><span class="line">&gt;&gt;&gt; <span class="string">"my name is &#123;name&#125;"</span>.format(<span class="property">name</span>=<span class="property">name</span>)</span><br><span class="line">'<span class="keyword">my</span> <span class="property">name</span> <span class="keyword">is</span> andrew'</span><br></pre></td></tr></table></figure></p>
</div><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a href="/2015/09/29/Docker-入门/" class="next">Docker 入门<i class="icon-next"></i></a></div><div data-thread-key="2015/10/15/Python技巧/" data-title="Python技巧" data-url="http://JasperLue.github.io/2015/10/15/Python技巧/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2015/10/15/Python技巧/" data-title="Python技巧" data-url="http://JasperLue.github.io/2015/10/15/Python技巧/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/">tech</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/Salt/" style="font-size: 15px;">Salt</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/10/15/Python技巧/">Python技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/29/Docker-入门/">Docker 入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/16/salt-ssh 使用体验/">salt-ssh 使用体验</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/15/第一篇：Hello-world/">第一篇：Hello World</a></li></ul></div><div class="widget"><div class="comments-title">最近评论</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://weibo.com/lvjinpeng/" title="我的微博" target="_blank">我的微博</a><ul></ul><a href="https://github.com/JasperLue" title="github" target="_blank">github</a><ul></ul><a href="http://www.zhihu.com/people/shanghai" title="知乎" target="_blank">知乎</a></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">JasperLue的blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>var duoshuoQuery = {short_name:'Jasperlue'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script></div></body></html>